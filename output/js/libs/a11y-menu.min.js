var A11yMenu=function(e,t){"use strict";var n=function(){var e,t=document.createElement("fake"),n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in n)if(void 0!==t.style[e])return n[e]},i=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},s={beforeOpen:function(){},beforeClose:function(){},tapStop:!1,nameSpace:"main-menu",itemClass:".js-menu-items",activeClass:"is-active",openClass:"is-shown",animateClass:"is-revealed",horizontal:!0};this.node=e,this.option=i(s,t),this.bndEvt=this.eventHandler.bind(this),this.bndClose=this.closeTrans.bind(this),this.bndOpen=this.openTrans.bind(this),this.transEvt=n(),this.nodeObj={menuItems:null,menuLinks:[],activeItem:null,activeLink:null,subMenus:[],activeSubMenu:null,subMenuOpen:!1},this.docActive=null};A11yMenu.prototype.destroy=function(){for(var e=0;e<this.nodeObj.menuItems.length;e++)this.nodeObj.menuItems[e].parentNode.classList.remove(this.option.openClass,this.option.animateClass);for(var e=0;e<this.nodeObj.menuLinks.length;e++)this.nodeObj.menuLinks[e].classList.remove(this.option.activeClass);this.nodeObj={menuItems:null,menuLinks:[],activeItem:null,activeLink:null,subMenus:[],activeSubMenu:null,subMenuOpen:!1,nextIndex:null},this.docActive=null,this.node.removeEventListener("keydown",this.bndEvt,!1),this.node.classList.remove("is-ready")},A11yMenu.prototype.init=function(){var e=this.nodeObj,t=this.option;e.menuItems=[].slice.call(this.node.querySelectorAll(t.itemClass));for(var n=0,i=e.menuItems.length;n<i;n++){var s=e.menuItems[n].querySelector("a[href],button:not([disabled])");if(e.menuLinks.push(s),t.tapStop&&(n?s.tabIndex=-1:s.tabIndex=0),s.hasAttribute("aria-haspopup")){var o=document.getElementById(s.getAttribute("aria-controls"));e.subMenus.push(o)}else e.subMenus.push(null);s.addEventListener("mouseover",this.bndEvt,!1)}this.node.addEventListener("keydown",this.bndEvt,!1),this.node.classList.add("is-ready")},A11yMenu.prototype.allowKey=function(e,t){if(e.indexOf(t)===-1)return!0},A11yMenu.prototype.focusable=function(e){for(var t=e.querySelectorAll("a[href],button:not([disabled])"),n=[],i=0;i<t.length;i++)0!==t[i].offsetHeight&&n.push(t[i]);return n},A11yMenu.prototype.eventHandler=function(e){var t=this.nodeObj,n=e.type,i="which"in e?e.which:e.keyCode;this.docActive=document.activeElement;var s=(this.node.contains(this.docActive),t.subMenuOpen),o=t.menuLinks.indexOf(this.docActive)!==-1,a=!!s&&t.activeSubMenu.contains(this.docActive),u=this.docActive.hasAttribute("aria-haspopup");if("keydown"===n)if(s&&27===i&&(t.activeLink.focus(),this.closeSub()),o&&!this.allowKey([38,40,37,39,32,13,27,9,16,36,35],i)){if(this.travelMain(e,i),u&&!s&&this.openEvent(e,i),s){if(this.allowKey([40,38],i))return;var r=this.focusable(t.activeSubMenu),l=38===i?r[r.length-1]:r[0];l.focus(),e.preventDefault()}}else a&&this.travelSub(e,i);"mouseover"===n&&s&&this.closeSub()},A11yMenu.prototype.travelMain=function(e,t){var n=this.nodeObj,i=n.menuLinks.indexOf(this.docActive),s=n.menuLinks.length-1;if(!this.allowKey([35,36,37,39],t)){if(this.homeEnd(e,n.menuLinks,t),37===t?i=0===i?s:i-1:39===t&&(i=i===s?0:i+1),!this.allowKey([37,39],t)&&(n.menuLinks[i].focus(),this.option.tapStop)){for(var o=0;o<n.menuLinks.length;o++)n.menuLinks[o].tabIndex=-1;n.menuLinks[i].tabIndex=0}if(n.subMenuOpen){var a=null!==n.subMenus[i]?i:void 0;this.closeSub(a)}}},A11yMenu.prototype.closeSub=function(e){var t=this.nodeObj,n=this.option;t.activeLink.classList.remove(n.activeClass),t.activeLink.setAttribute("aria-expanded",!1),n.beforeClose(),t.activeItem.classList.remove(n.animateClass),t.nextIndex=e,t.activeSubMenu.addEventListener(this.transEvt,this.bndClose,!1)},A11yMenu.prototype.closeTrans=function(e){if("opacity"===e.propertyName){var t=this.nodeObj,n=this.option;t.activeItem.classList.remove(n.openClass),t.activeSubMenu.removeEventListener(this.transEvt,this.bndClose,!1),t.activeSubMenu=t.activeItem=t.activeLink=null,t.subMenuOpen=!1,document.documentElement.classList.remove(n.nameSpace+"-open"),void 0!==t.nextIndex&&this.openSub(t.nextIndex)}},A11yMenu.prototype.openEvent=function(e,t){var n=this.nodeObj,i=n.menuLinks.indexOf(this.docActive);if(!e.target.classList.contains("is-active")){if(this.option.horizontal){if(this.allowKey([40,32,13,1,38],t))return;38===t?this.openSub(i,!1):this.openSub(i,!0)}else{if(this.allowKey([37,32,13,1,39],t))return;39===t?this.openSub(i,!0):37===t&&this.openSub(i,!1)}e.preventDefault()}},A11yMenu.prototype.openSub=function(e,t){var n,i=this.nodeObj,s=this.option,o=this;i.activeSubMenu=i.subMenus[e],i.activeLink=i.menuLinks[e],i.activeItem=i.menuItems[e],i.activeLink.classList.add(s.activeClass),i.activeLink.setAttribute("aria-expanded",!0),i.activeItem.classList.add(s.openClass),s.beforeOpen(),n=setTimeout(function(){i.activeSubMenu.addEventListener(o.transEvt,o.bndOpen,!1),i.activeItem.classList.add(s.animateClass),i.subMenuOpen=!0,clearTimeout(n)},10);var a=this.focusable(i.activeSubMenu);if(void 0!==t){var e=t===!0?0:a.length-1;a[e].focus()}},A11yMenu.prototype.openTrans=function(e){"opacity"===e.propertyName&&(document.documentElement.classList.add(this.option.nameSpace+"-open"),this.nodeObj.activeSubMenu.removeEventListener(this.transEvt,this.bndOpen,!1))},A11yMenu.prototype.travelSub=function(e,t){if(!this.allowKey([37,38,39,40,9,35,36],t)){var n=this.nodeObj,i=this.option,s=this.focusable(n.activeSubMenu),o=s.length-1,a=this;if(i.tapStop){for(var u=0;u<s.length;u++)s[u].tabIndex=-1;s[0].tabIndex=0}this.homeEnd(e,s,t);(function(){if(!a.allowKey([38,40],t)){var n=s.indexOf(a.docActive);n=40===t?n===o?0:n+1:0===n?o:n-1,s[n].focus(),e.preventDefault()}})(),function(){if(!a.allowKey([37,39],t)){var i=n.subMenus.indexOf(n.activeSubMenu),s=n.subMenus.length-1;if(i=37===t?0===i?s:i-1:i===s?0:i+1,n.menuLinks[i].focus(),a.option.tapStop){for(var o=0;o<n.menuLinks.length;o++)n.menuLinks[o].tabIndex=-1;n.menuLinks[i].tabIndex=0}var u=null!==n.subMenus[i]?i:void 0;a.closeSub(u),e.preventDefault()}}(),function(){9!==t||i.tapStop||(e.shiftKey&&a.docActive===s[0]?(s[o].focus(),e.preventDefault()):e.shiftKey||a.docActive!==s[o]||(s[0].focus(),e.preventDefault()))}()}},A11yMenu.prototype.homeEnd=function(e,t,n){if(!this.allowKey([35,36],n)){var i=36===n?0:t.length-1;t[i].focus(),e.preventDefault()}};